<title>[[Gallery]]</title>

<p id="breadcrumbs">
	<span class='fai'>&#xe08d;</span> "{{.UploaderName}}" [[Gallery]]

	{{if .IsSelf}}
	| <span data-dropdown="gallery-function">
		<span class='fai'>&#xe072;</span> 
		<span class="nc">[[Images]]</span>
	</span>
	{{end}}

<script type="text/javascript">
	document.title += " -- " + etc.date.format({{.Nav.Range.End}});
	document.write(' | <span class="fai">&#xe0b0;</span> ' + etc.date.format({{.Nav.Range.Start}}) + 
	' | <span class="fai">&#xe0b6;</span> ' + etc.date.format({{.Nav.Range.End}}));
</script>
</p>

<div id="gallery-function" class="dropdown">
	<ul>
		<li><span class='fai'>&#xe123;</span> <a data-onclick="deleteImages()">[[Delete selected]]</a></li>
		<li><span class='fai'>&#xe123;</span> <a data-onclick="deleteImages(true)">[[Delete all in this page]]</a></li>
		<li><span class='fai'>&#xe072;</span> <a href="javascript:selectAll()">[[Select all]]</a></li>
		<li><span class='fai'>&#xe072;</span> <a href="javascript:invertSelection()">[[Inverse selection]]</a></li>
	</ul>
</div>

<script type="text/javascript">
	document.write(buildPager({{.IsIndexPage}}, {{.IsLastPage}},
		"{{.IndexPage}}", "{{.LastPage}}", "{{.Nav.PrevPage}}", "{{.Nav.NextPage}}",
		"{{.Nav.LastWeekPage}}", "{{.Nav.LastMonthPage}}", "{{.Nav.LastYearPage}}"));
</script>

<script type="text/javascript">
	function selectAll() {
		var checks = etc.get(".simple-check");

		for (var i = 0; i < checks.length; i++) {
			checks[i].checked = true;
		}
	}

	function invertSelection() {
		var checks = etc.get(".simple-check");

		for (var i = 0; i < checks.length; i++) {
			checks[i].checked = !checks[i].checked;
		}
	}

	function deleteImages(all) {
		var checks = etc.get(".simple-check");
		var ids = [];

		for (var i = 0; i < checks.length; i++) {
			if (checks[i].checked || all) {
				ids.push(checks[i].getAttribute("data-id"));
			}
		}

		if (ids.length == 0) return etc.wait.on(this).done();
		if (!confirm("[[Confirm to delete]]: " + ids.join(","))) return etc.wait.on(this).done();

		etc.util.ajax.post("/delete/images", { 
			"ids": ids.join(","),
			"csrf": etc.util.CSRF() 
		}).then(function(e, text) {
			etc.wait.on(this).done();

			if (text == "ok") {
				alert("[[Operation completed]]");
				window.location.reload();
			} else {
				alert("[[Error: ]]" + text);			
			}
		});

		return etc.wait.on(this);
	}
</script>

<div id="gallery">
	{{range .Images}}
		<div class="image">
			<div>
				<span class="img-id">{{.ID}}</span>
				<a href="{{.Path}}" target="_blank"><img src="{{.ThumbPath}}"></a>
			</div>

			<div class="date">
				<input type="checkbox" class="simple-check" id="img-{{.ID}}" data-id="{{.ID}}">
				<label for="img-{{.ID}}"><script type="text/javascript">
				document.write(etc.date.format({{.Timestamp}}));
				</script></label>
			</div>
		</div>
	{{end}}
</div>

<script type="text/javascript">
	document.write(buildPager({{.IsIndexPage}}, {{.IsLastPage}},
		"{{.IndexPage}}", "{{.LastPage}}", "{{.Nav.PrevPage}}", "{{.Nav.NextPage}}",
		"{{.Nav.LastWeekPage}}", "{{.Nav.LastMonthPage}}", "{{.Nav.LastYearPage}}"));
</script>