<title>[[Gallery]]</title>

<p id="breadcrumbs">
	<span class='fai'>&#xe08d;</span> "{{.UploaderName}}" [[Gallery]]

	{{if .IsSelf}}
	| <span data-dropdown="gallery-function">
		<span class='fai'>&#xe072;</span> 
		<span class="nc">删除</span>
	</span>
	{{end}}

<script type="text/javascript">
	document.title += " -- " + etc.date.format({{.Nav.Range.End}});
	document.write(' | <span class="fai">&#xe0b0;</span> ' + etc.date.format({{.Nav.Range.Start}}) + 
	' | <span class="fai">&#xe0b6;</span> ' + etc.date.format({{.Nav.Range.End}}));
</script>
</p>

<div id="gallery-function" class="dropdown">
	<ul>
		<li><span class='fai'>&#xe123;</span> <a data-onclick="deleteImages()">删除选定</a></li>
		<li><span class='fai'>&#xe123;</span> <a data-onclick="deleteImages(true)">删除全部</a></li>
		<li><span class='fai'>&#xe072;</span> <a href="javascript:selectAll()">全选</a></li>
		<li><span class='fai'>&#xe072;</span> <a href="javascript:invertSelection()">反选</a></li>
	</ul>
</div>

<div class="pager">
	{{if .IsIndexPage}}[ <b>首页</b> ]{{else}}
	[
	<a href="{{.IndexPage}}"> 首页 </a> |
	<a href="{{.Nav.PrevPage}}"> 上一页 </a>
	]
	{{end}}

	{{if .IsLastPage}}
	[ <b>尾页</b> ]
	{{else}}
	[
	<a href="{{.Nav.NextPage}}"> 下一页 </a> |
	<a href="{{.Nav.LastWeekPage}}" >周</a> |
	<a href="{{.Nav.LastMonthPage}}">月</a> |
	<a href="{{.Nav.LastYearPage}}">年</a> |
	<a href="{{.LastPage}}" >尾页</a>
	]
	{{end}}
</div>

<script type="text/javascript">
	function selectAll() {
		var checks = etc.get(".simple-check");

		for (var i = 0; i < checks.length; i++) {
			checks[i].checked = true;
		}
	}

	function invertSelection() {
		var checks = etc.get(".simple-check");

		for (var i = 0; i < checks.length; i++) {
			checks[i].checked = !checks[i].checked;
		}
	}

	function deleteImages(all) {
		var checks = etc.get(".simple-check");
		var ids = [];

		for (var i = 0; i < checks.length; i++) {
			if (checks[i].checked || all) {
				ids.push(checks[i].getAttribute("data-id"));
			}
		}

		if (ids.length == 0) return;
		if (!confirm("是否删除: " + ids.join(","))) return;

		etc.util.ajax.post("/delete/images", { 
			"ids": ids.join(","),
			"csrf": etc.util.CSRF() 
		}).then(function(e, text) {
			etc.wait.on(this).done();

			if (text == "ok") {
				alert("[[Operation completed]]");
				window.location.reload();
			} else {
				alert("[[Error: ]]" + text);			
			}
		});

		return etc.wait.on(this);
	}
</script>

<div id="gallery">
	{{range .Images}}
		<div class="image">
			<div>
				<a href="/img/{{.Path}}" target="_blank"><img src="/timg/{{.Path}}"></a>
			</div>

			<div class="date">
				<input type="checkbox" class="simple-check" id="img-{{.ID}}" data-id="{{.ID}}">
				<label for="img-{{.ID}}"><script type="text/javascript">
				document.write(etc.date.format({{.Timestamp}}));
				</script></label>
			</div>
		</div>
	{{end}}
</div>

<div class="pager">
	{{if .IsIndexPage}}[ <b>首页</b> ]{{else}}
	[
	<a href="{{.IndexPage}}"> 首页 </a> |
	<a href="{{.Nav.PrevPage}}"> 上一页 </a>
	]
	{{end}}
	{{if .IsLastPage}}
	[ <b>尾页</b> ]
	{{else}}
	[
	<a href="{{.Nav.NextPage}}"> 下一页 </a> |
	<a href="{{.Nav.LastWeekPage}}" >周</a> |
	<a href="{{.Nav.LastMonthPage}}">月</a> |
	<a href="{{.Nav.LastYearPage}}">年</a> |
	<a href="{{.LastPage}}" >尾页</a>
	]
	{{end}}
	
</div>