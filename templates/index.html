<script type="text/javascript">
	document.title = "[[Index]] -- " + window.__title;
</script>

<p id="breadcrumbs">
	<span data-dropdown="language">
		<span class='fai'>&#xe149;</span>
		<span class='nc'>[[Language]]</span>
	</span>

	<span><span class='fai' title='[[Total Articles]]'>&#xe062;</span> {{.TotalArticles}}</span>

	<span><span class='fai' title='[[Total Images]]'>&#xe08d;</span> {{.TotalImages}}</span>

	<span><span class='fai' title='[[Total Users]]'>&#xe083;</span> {{.TotalUsers}}</span>

	<span><span class='fai'>&#xe0dc;</span> <a href="/feed/atom">Atom</a></span>

	<span><span class='fai'>&#xe0dc;</span> <a href="/feed/rss">RSS</a></span>

	<span><span class='fai'>&#xe14f;</span>
	<a href="javascript:window.open('https://www.google.com/search?q=site%3A' + window.location.href)">Google</a>
	</span>
</p>

<div id="language" class="dropdown">
	<ul>
		<li onclick="setLang('zh-cn')"><span>Simplified Chinese</span></li>
		<li onclick="setLang('zh-tw')"><span>Traditional Chinese</span></li>
		<li onclick="setLang('en-us')"><span>English (beta)</span></li>
	</ul>
</div>

<style type="text/css">
	#about div {
		margin: 4px 0; 
	}

	#index-image {
		margin:auto;
		width:100%;
		max-width:350px;
		display:block;
	}

	#upload-area {
		border: dashed 2px #ccc;
		padding: 6px 10px;
		width: 100%;
	}

	#upload-area > div { cursor: pointer; }
	#upload-area > div:hover { color: steelblue; }

	#select-code {
		display: none;
	}

	#select-code > div { 
		height: 24px; 
	}

	#select-code > div * {
		height: 100%;
		vertical-align: top;
	}

	.image-code {
		width: 100%;
		resize: vertical;
	}
</style>

<div style="text-align: center">

	<table style="margin: 0 auto"><tr>
	<td style="width: 33%" id="index-image-td">
		<img id="index-image" src="/assets/images/inazuma.svg">
		<div style="font-size: 80%">
		Pixiv: <a href="http://www.pixiv.net/member_illust.php?mode=medium&illust_id=53691885" target="_blank">53691885</a>,
		Vectorized by Coyove
		</div>
	</td>
	<td>
		<div id="about">
			<div>
				tmp.is a super duper simple image hosting site	
			</div>
			{{if .IsLoggedIn}}
				{{if .CanPostImages}}
				<input style="display: none" id="select-file" type="file" multiple>
				<div id="upload-area">
					<div onclick='etc.id("select-file").click()'>
						[[Select or drag'n drop images to upload]] 
						<span id="uploading-sign"></span>
					</div>
					<div id="select-code">
						<div>
							<select id="select-code-type">
								<option value="image-full-url">[[Full Images URL]]</option>
								<option value="image-thumb-url">[[Thumb Images URL]]</option>
								<option value="image-full-bbcode" selected>[[Full Images BBCode]]</option>
								<option value="image-thumb-bbcode">[[Thumb Images BBCode]]</option>
								<option value="image-full-md">[[Full Images Markdown]]</option>
								<option value="image-thumb-md">[[Thumb Images Markdown]]</option>
							</select>
							<a class="title block inline-block" href="javascript:copy()">
								<span class='fai'>&#xe04a;</span>
							</a>
						</div>
						<textarea style="display:none" class="image-code" id="image-full-url" readonly></textarea>
						<textarea style="display:none" class="image-code" id="image-thumb-url" readonly></textarea>
						<textarea class="image-code" id="image-full-bbcode" readonly></textarea>
						<textarea style="display:none" class="image-code" id="image-thumb-bbcode" readonly></textarea>
						<textarea style="display:none" class="image-code" id="image-full-md" readonly></textarea>
						<textarea style="display:none" class="image-code" id="image-thumb-md" readonly></textarea>
					</div>
				</div>

				<div>
					<input type="checkbox" class="simple-check" id="hide-image">
					<label for="hide-image">[[Hide in my gallery]]</label>
				</div>
				{{else}}
					<div>您所在的用户组无法上传图片</div>
				{{end}}
			{{else}}
				<div>[[To upload images, please ]]<a href="/account">[[sign in]]</a></div>
			{{end}}
		</div>
	</td>
	</tr></table>
</div>

<script type="text/javascript">
    etc.id('index-image').src = window.__logoImg;

    function setLang(lang) {
    	i18n(lang);
    	window.location.reload();
    }

    var upa = etc.id("upload-area");

    upa.ondragover = function(e) { 
    	e.preventDefault();
    	upa.style.backgroundColor = "#abceea";
    }

    upa.ondragleave = function(e) { 
    	e.preventDefault(); 
    	upa.style.backgroundColor = "white";
    }
    
    upa.ondrop = function(e) {
    	e.preventDefault(); 
    	upa.style.backgroundColor = "white";

    	goUploading(etc.file(e.dataTransfer.files))
    }

    etc.id("select-file").onchange = function(e) { 
		Animation.start("uploading-sign");
		goUploading(etc.file('select-file', e));
		etc.id("select-file").value = "";
	}

	etc.id("select-code-type").onchange = function(e) {
		var texts = etc.get(".image-code");
		for (var i = 0; i < texts.length; i++) {
        	texts[i].style.display = "none";
		}

		etc.let.show(this.value);
	}

	function copy() {
		etc.id(etc.id("select-code-type").value).focus();
		etc.id(etc.id("select-code-type").value).select();
		document.execCommand('copy');
	}

	function goUploading(files) {
		Animation.start("uploading-sign");
    	var uploaded = {
    		"additional_form": {
    			"hide": etc.id("hide-image").checked
    		},
    		"uploaded_callback": function(thumb, full) {
				var a = document.createElement("a");
				var img = document.createElement("img");

				img.style.maxWidth = "100px";
				img.style.maxHeight = "100px";
				img.src = thumb;

				a.href = full;
				a.target = "_blank";

				a.appendChild(img);
				upa.appendChild(a);

				window.UploadedImages = window.UploadedImages || {};

				etc.id("image-full-url").value += full + "\n";
				etc.id("image-thumb-url").value += thumb + "\n";

				etc.id("image-full-bbcode").value += "[img]" + full + "[/img]\n";
				etc.id("image-thumb-bbcode").value += "[url=" + full + "][img]" + thumb + "[/img][/url]\n";

				etc.id("image-full-md").value += "![](" + full + ")\n";
				etc.id("image-thumb-md").value += "![](" + thumb + ")\n";

				etc.let.show("select-code");
    		}
    	};

    	etc.editor.uploadImage(files, function(err) {
			Animation.stop();
			if (err) {
				etc.id("uploading-sign").html(err);
			}
		}, uploaded);
	}
</script>