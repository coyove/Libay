!function(a){function b(){this._callbacks=[]}function c(a){function g(a){return function(){e+=1,d[a]=Array.prototype.slice.call(arguments),e===f&&c.done(d)}}var c=new b,d=[];if(!a||!a.length)return c.done(d),c;for(var e=0,f=a.length,h=0;f>h;h++)a[h].then(g(h));return c}function d(a,c){var e=new b;return 0===a.length?e.done.apply(e,c):a[0].apply(null,c).then(function(){a.splice(0,1),d(a,arguments).then(function(){e.done.apply(e,arguments)})}),e}function e(a){var b="";if("string"==typeof a)b=a;else{var c=encodeURIComponent,d=[];for(var e in a)a.hasOwnProperty(e)&&d.push(c(e)+"="+c(a[e]));b=d.join("&")}return b}function f(){var a;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}return a}function g(a,c,d,g){function p(){j.abort(),h.done(i.ETIMEOUT,"",j)}var j,k,h=new b;d=d||{},g=g||{};try{j=f()}catch(l){return h.done(i.ENOXHR,""),h}var m="application/x-www-form-urlencoded";if("$"==a[0]){a=a.substring(1),k=new FormData,m="";for(var n in d)d.hasOwnProperty(n)&&k.append(n,d[n])}else k=e(d),"GET"===a&&k&&(c+="?"+k,k=null);j.open(a,c);for(var o in g)g.hasOwnProperty(o)&&("content-type"===o.toLowerCase()?m=g[o]:j.setRequestHeader(o,g[o]));""!=m&&j.setRequestHeader("Content-type",m);var q=i.ajaxTimeout;if(q)var r=setTimeout(p,q);return j.onreadystatechange=function(){if(q&&clearTimeout(r),4===j.readyState){var a=!j.status||(j.status<200||j.status>=300)&&304!==j.status;h.done(a,j.responseText,j)}},j.send(k),h}function h(a){return function(b,c,d){return g(a,b,c,d)}}b.prototype.then=function(a,c){var d;return this._isdone?d=a.apply(c,this.result):(d=new b,this._callbacks.push(function(){var b=a.apply(c,arguments);b&&"function"==typeof b.then&&b.then(d.done,d)})),d},b.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,arguments);this._callbacks=[]};var i={Promise:b,join:c,chain:d,ajax:g,get:h("GET"),post:h("POST"),$post:h("$POST"),put:h("PUT"),del:h("DELETE"),ENOXHR:1,ETIMEOUT:2,ajaxTimeout:2e4},j=function(a){var b="string"==typeof a||a instanceof String?document.getElementById(a):a;return null==b?{}:(b.on=function(a,c,d){return b.addEventListener?b.addEventListener(a,c,d):b.attachEvent("on"+a,c),b},b.html=function(a){return"string"==typeof a?b.innerHTML=a:a.innerHTML&&(b.innerHTML=a.innerHTML),b},b.attr=function(a,c){return c?(b.setAttribute(a,c),b):b.getAttribute(a)},b)},k=null,l=function(){var a=function(a){var b,c,d;return document.selection?(b=document.selection.createRange(),b.collapse(a),b.parentElement()):(c=window.getSelection(),c.getRangeAt?c.rangeCount>0&&(b=c.getRangeAt(0)):(b=document.createRange(),b.setStart(c.anchorNode,c.anchorOffset),b.setEnd(c.focusNode,c.focusOffset),b.collapsed!==c.isCollapsed&&(b.setStart(c.focusNode,c.focusOffset),b.setEnd(c.anchorNode,c.anchorOffset))),b?(d=b[a?"startContainer":"endContainer"],3===d.nodeType?d.parentNode:d):void 0)},b=function(a){if(a&&a.getAttribute){if("true"==a.getAttribute("contenteditable"))return!0;if(a.parentNode)return b(a.parentNode)}return!1};return b(a())},m=function(a){var b,c;if(window.getSelection){if(b=window.getSelection(),b.getRangeAt&&b.rangeCount){c=b.getRangeAt(0),c.deleteContents();var d=document.createElement("div");d.innerHTML=a;for(var f,g,e=document.createDocumentFragment();f=d.firstChild;)g=e.appendChild(f);c.insertNode(e),g&&(c=c.cloneRange(),c.setStartAfter(g),c.collapse(!0),b.removeAllRanges(),b.addRange(c))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(a)};a.etc={id:j,file:function(a,b){if(a[0]&&a[0].type&&a.length){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);return c}var e=j(a);if(e.files&&e.files[0]){for(var c=[],d=0;d<e.files.length;d++)c.push(e.files[d]);return c}return b&&b.target&&b.target.value?[b.target.value]:[]},get:function(a){return document.querySelectorAll(a)},let:{hide:function(b){return a.etc.let.$=j(b),a.etc.let.$.style.display="none",a.etc.let},show:function(b){a.etc.let.$=j(b);var c=a.etc.let.$;switch(c.tagName.toLowerCase()){case"td":c.style.display="table-cell";break;case"table":c.style.display="table";break;case"a":case"span":c.style.display="inherit";break;default:c.style.display="block"}return a.etc.let},disable:function(b){return a.etc.let.$=j(b),a.etc.let.$.disabled=!0,a.etc.let},enable:function(b){return a.etc.let.$=j(b),a.etc.let.$.disabled=!1,a.etc.let}},date:{format:function(a){var b=new Date(a),d=(new Date,b.getFullYear()),e=b.getMonth()<9?"0"+(b.getMonth()+1):b.getMonth()+1,f=b.getDate()<10?"0"+b.getDate():b.getDate(),g=b.getHours()<10?"0"+b.getHours():b.getHours(),h=b.getMinutes()<10?"0"+b.getMinutes():b.getMinutes();b.getSeconds()<10?"0"+b.getSeconds():b.getSeconds();return ret=d+"/"+e+"/"+f+" "+g+":"+h,ret},now:function(){var a=new Date,b=a.getHours()<10?"0"+a.getHours():a.getHours(),c=a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes(),d=a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds();return b+":"+c+":"+d}},string:{unescape:function(a){var b=document.createElement("div");b.innerHTML=a;for(var c="",d=0;d<b.childNodes.length;++d)c+=b.childNodes[d].nodeValue;return c},utf8Len:function(a){if(encodeURIComponent){var b=encodeURIComponent(a).match(/%[89ABab]/g);return a.length+(b?b.length:0)}return 0},base64Decode:function(a){var b={};return b.PADCHAR="=",b.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b.makeDOMException=function(){try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(b){var c=new Error("DOM Exception 5");return c.code=c.number=5,c.name=c.description="INVALID_CHARACTER_ERR",c.toString=function(){return"Error: "+c.name+": "+c.message},c}},b.getbyte64=function(a,c){var d=b.ALPHA.indexOf(a.charAt(c));if(-1===d)throw b.makeDOMException();return d},b.decode=function(a){a=""+a;var d,e,f,c=b.getbyte64,g=a.length;if(0===g)return a;if(g%4!==0)throw b.makeDOMException();d=0,a.charAt(g-1)===b.PADCHAR&&(d=1,a.charAt(g-2)===b.PADCHAR&&(d=2),g-=4);var h=[];for(e=0;g>e;e+=4)f=c(a,e)<<18|c(a,e+1)<<12|c(a,e+2)<<6|c(a,e+3),h.push(String.fromCharCode(f>>16,f>>8&255,255&f));switch(d){case 1:f=c(a,e)<<18|c(a,e+1)<<12|c(a,e+2)<<6,h.push(String.fromCharCode(f>>16,f>>8&255));break;case 2:f=c(a,e)<<18|c(a,e+1)<<12,h.push(String.fromCharCode(f>>16))}return h.join("")},b.decode(a)}},util:{ajax:i,isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)&&parseInt(a)>0},CSRF:function(){return j("csrf").innerHTML},lazyLoad:function(a,b){var c=window.__cdn,d=function(){var e=function(){a.shift(),a.length>0?d():b&&b()},f=null,g=c+a[0];if(/\.js$/.test(g)){f=document.createElement("script");var h=document.querySelectorAll("script");for(var i in h)h[i].src==g&&e();f.src=g,f.async=!0,f.onreadystatechange=f.onload=function(){(!f.readyState||/loaded|complete/.test(f.readyState))&&e()}}else if(/\.css$/.test(g)){f=document.createElement("link");var j=document.querySelectorAll("link");for(var i in j)j[i].href==g&&e();f.rel="stylesheet",f.type="text/css",f.href=g,f.media="all",e()}null!=f&&document.querySelector("head").appendChild(f)};d()},read:function(a){return window.attachEvent&&!window.addEventListener?null:localStorage?localStorage.getItem(a):null},write:function(a,b){return window.attachEvent&&!window.addEventListener?null:localStorage?localStorage.setItem(a,b):null},storage:{remove:function(a){return window.attachEvent&&!window.addEventListener?null:void(localStorage&&localStorage.removeItem(a))}}},editor:{wrap:function(a){k=a},insertHTML:m,isInside:l,uploadImage:function(a,b,c){if(c=c||{},0==a.length)return void b();var d=a.shift(),e=function(a){alert("Err::Upload::"+a),b&&b()};if(!l()&&c.editor)return void(b&&b());if(!(d&&d.type.match(/image.*/)||/\.(jpg|png)\-(small|large)/.test(d.name)))return void e("Invalid_Image");var f=window.URL||window.webkitURL,g=new Image,h=function(f,g){etc.util.ajax.$post(c.imgur?"https://api.imgur.com/3/image":"/upload",{image:d,width:f,height:g},{Authorization:"Client-ID c37fc05199a05b7"}).then(function(d,f,g){if(d)return void e("AJAX");try{var h=c.imgur?JSON.parse(f).data:JSON.parse(f)}catch(i){return e("JSON")}if(h.Error||h.error)return e("Server_Failure_"+h.R||h.error);var k=(h.Link||h.link).replace("http://","https://"),l=(h.Thumbnail||h.link).replace("http://","https://");c.editor&&(j(c.editor).focus(),m("<a href='"+k+"' target='_blank'><img src='"+l+"' class='article-image'></a>")),etc.editor.uploadImage(a,b,c)})};g.onload=function(){h(this.width,this.height)},f&&f.createObjectURL?g.src=f.createObjectURL(d):h(1024,1024)},insertLink:function(){if(l()){var a=prompt("URL:","http://"),b=window.getSelection?window.getSelection():document.selection;"http://"!=a&&""!=a&&((""==b||null==b)&&(b=prompt("显示文字:",a)),j(k).focus(),m("<a href='"+a+"' target='_blank'>"+b+"</a>"))}},insertList:function(a){j(k).focus(),"ol"==a?document.execCommand("insertorderedlist",!1):document.execCommand("insertunorderedlist",!1)},insertNode:function(a,b){j(k).focus(),"heading"==a?document.execCommand("formatBlock",!1,"<"+b+">"):document.execCommand(a,!1,b)},insertTable:function(){var a=prompt("Cols x Rows:","3x2"),b=a.split("x");if(!(b.length<2)){var c=parseInt(b[0]),d=parseInt(b[1]),e="<tr>"+new Array(c+1).join("<td>@</td>")+"</tr>",f="<table border=1>"+new Array(d+1).join(e)+"</table>";m(f)}}}}}(this);var Gallery=function(){return{_Normal:function(){etc.id("gallery").style.display="none",etc.id("article-content").style.display="block"},_Gallery:function(){var a=etc.id("article-content"),b=etc.get("#article-content img");Gallery._Gallery.imgList=[],Gallery._Gallery.index=0;for(var c=0;c<b.length;c++){var d=b[c].src;/thumbs\/\S+[0-9a-f]{38}\./.test(d)?Gallery._Gallery.imgList.push(d.replace("/thumbs/","/images/")):Gallery._Gallery.imgList.push(d)}if(0!=Gallery._Gallery.imgList.length){var e="[<a href='javascript:Gallery._Gallery_Prev()'>上一张</a>]<span class='gallery-pager'></span>[<a href='javascript:Gallery._Gallery_Next()'>下一张</a>] [<a href='javascript:Gallery._Gallery_Goto(true)'>重新载入</a>]"+'<style>.gallery-page-no{margin:0 0.33em;text-decoration:none;}.gallery-page-no:before{content:"[";}.gallery-page-no:after{content:"]";}</style>';e=e+"<div><div id='gallery-loading' style='background-image:url("+window.__cdn+"/assets/images/loading.gif); display: none; position: absolute; z-index:99; opacity: 0.5; filter: alpha(opacity=50);'></div><img onclick='Gallery._Gallery_Next()' id='gallery-image' style='cursor: pointer; max-width:100%; display: block'/></div>"+e;var f=etc.id("gallery");f.id||(f=document.createElement("div"),f.innerHTML=e,f.id="gallery",a.parentNode.appendChild(f)),a.style.display="none",f.style.display="block";for(var g=document.querySelectorAll(".gallery-pager"),c=0;c<g.length;c++){for(var e=[],h=0;h<Gallery._Gallery.imgList.length;h++)e.push("<a id='gallery-page-"+c+"-"+h+"' class='gallery-page-no' href='javascript:Gallery._Gallery_Goto("+h+")'>"+(h+1)+"</a>");g[c].innerHTML=e.join("")}Gallery._Gallery_Goto(0)}},_Gallery_Next:function(){Gallery._Gallery.index++,Gallery._Gallery_Goto(Gallery._Gallery.index)},_Gallery_Prev:function(){Gallery._Gallery.index--,Gallery._Gallery_Goto(Gallery._Gallery.index)},_Gallery_Goto:function(a){a===!0&&(a=Gallery._Gallery.index),0>a?a=0:a>=Gallery._Gallery.imgList.length&&(a=Gallery._Gallery.imgList.length-1),Gallery._Gallery.index=a;for(var b=0;b<Gallery._Gallery.imgList.length;b++){var c=etc.id("gallery-page-1-"+b),d=etc.id("gallery-page-0-"+b);c.style.color=d.style.color="#ccc",c.style.display=d.style.display=Math.abs(b-a)<=5?"inherit":"none"}var e=new Image,f=etc.id("gallery-image"),g=etc.id("gallery-loading"),h=document.documentElement.scrollTop;e.onload=function(){etc.let.hide("gallery-loading"),f.src=this.src,etc.id("gallery-page-1-"+a).style.color="black",etc.id("gallery-page-0-"+a).style.color="black",document.documentElement.scrollTop=h},e.src=Gallery._Gallery.imgList[a],g.style.width=(f.clientWidth?f.clientWidth:64)+"px",g.style.height=(f.clientHeight?f.clientHeight:64)+"px",e&&etc.let.show("gallery-loading")}}}(),Animation=function(){var a,b;return{start:function(c){if(a)return void console.log("duplicated animation");var d=["⣾","⣽","⣻","⢿","⡿","⣟","⣯","⣷"],e=0;b=c,a=setInterval(function(){etc.id(c).innerHTML=d[e],e++,e>7&&(e=0)},100)},stop:function(){var c=etc.id(b);c&&(c.innerHTML=""),a&&clearInterval(a),a=null}}}();