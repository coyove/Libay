!function(g){function Promise(){this._callbacks=[]}function join(e){function t(e){return function(){i+=1,r[e]=Array.prototype.slice.call(arguments),i===o&&n.done(r)}}var n=new Promise,r=[];if(!e||!e.length)return n.done(r),n;for(var i=0,o=e.length,a=0;o>a;a++)e[a].then(t(a));return n}function chain(e,t){var n=new Promise;return 0===e.length?n.done.apply(n,t):e[0].apply(null,t).then(function(){e.splice(0,1),chain(e,arguments).then(function(){n.done.apply(n,arguments)})}),n}function _encode(e){var t="";if("string"==typeof e)t=e;else{var n=encodeURIComponent,r=[];for(var i in e)e.hasOwnProperty(i)&&r.push(n(i)+"="+n(e[i]));t=r.join("&")}return t}function new_xhr(){var e;if(window.XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){e=new ActiveXObject("Microsoft.XMLHTTP")}return e}function ajax(e,t,n,r){function i(){o.abort(),c.done(promise.ETIMEOUT,"",o)}var o,a,c=new Promise;n=n||{},r=r||{};try{o=new_xhr()}catch(s){return c.done(promise.ENOXHR,""),c}var l="application/x-www-form-urlencoded";if("$"==e[0]){e=e.substring(1),a=new FormData,l="";for(var u in n)n.hasOwnProperty(u)&&a.append(u,n[u])}else a=_encode(n),"GET"===e&&a&&(t+="?"+a,a=null);o.open(e,t);for(var d in r)r.hasOwnProperty(d)&&("content-type"===d.toLowerCase()?l=r[d]:o.setRequestHeader(d,r[d]));""!=l&&o.setRequestHeader("Content-type",l);var f=promise.ajaxTimeout;if(f)var g=setTimeout(i,f);return o.onreadystatechange=function(){if(f&&clearTimeout(g),4===o.readyState){var e=!o.status||(o.status<200||o.status>=300)&&304!==o.status;c.done(e,o.responseText,o)}},o.send(a),c}function _ajaxer(e){return function(t,n,r){return ajax(e,t,n,r)}}function _WaitObject(){this.isDone=!1}Promise.prototype.then=function(e,t){var n;return this._isdone?n=e.apply(t,this.result):(n=new Promise,this._callbacks.push(function(){var r=e.apply(t,arguments);r&&"function"==typeof r.then&&r.then(n.done,n)})),n},Promise.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var e=0;e<this._callbacks.length;e++)this._callbacks[e].apply(null,arguments);this._callbacks=[]};var promise={Promise:Promise,join:join,chain:chain,ajax:ajax,get:_ajaxer("GET"),post:_ajaxer("POST"),$post:_ajaxer("$POST"),put:_ajaxer("PUT"),del:_ajaxer("DELETE"),ENOXHR:1,ETIMEOUT:2,ajaxTimeout:2e4},_id=function(e){var t="string"==typeof e||e instanceof String?document.getElementById(e):e;return null==t?{}:(t.on=function(e,n,r){return t.addEventListener?t.addEventListener(e,n,r):t.attachEvent("on"+e,n),t},t.html=function(e){return"string"==typeof e?t.innerHTML=e:e.innerHTML?t.innerHTML=e.innerHTML:t.innerHTML=e,t},t.attr=function(e,n){return n?(t.setAttribute(e,n),t):t.getAttribute(e)},t)},_editorId=null,_insideEditor=function(){var e=function(e){var t,n,r;return document.selection?(t=document.selection.createRange(),t.collapse(e),t.parentElement()):(n=window.getSelection(),n.getRangeAt?n.rangeCount>0&&(t=n.getRangeAt(0)):(t=document.createRange(),t.setStart(n.anchorNode,n.anchorOffset),t.setEnd(n.focusNode,n.focusOffset),t.collapsed!==n.isCollapsed&&(t.setStart(n.focusNode,n.focusOffset),t.setEnd(n.anchorNode,n.anchorOffset))),t?(r=t[e?"startContainer":"endContainer"],3===r.nodeType?r.parentNode:r):void 0)},t=function(e){if(e&&e.getAttribute){if("true"==e.getAttribute("contenteditable"))return!0;if(e.parentNode)return t(e.parentNode)}return!1};return t(e())},_insertHTML=function(e){var t,n;if(window.getSelection){if(t=window.getSelection(),t.getRangeAt&&t.rangeCount){n=t.getRangeAt(0),n.deleteContents();var r=document.createElement("div");r.innerHTML=e;for(var i,o,a=document.createDocumentFragment();i=r.firstChild;)o=a.appendChild(i);n.insertNode(a),o&&(n=n.cloneRange(),n.setStartAfter(o),n.collapse(!0),t.removeAllRanges(),t.addRange(n))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(e)};_WaitObject.prototype._call=function(){this.callback(),this.isDone=!1,this.callback=null},_WaitObject.prototype.done=function(){return this.isDone=!0,this.callback&&this._call(),this},_WaitObject.prototype.wait=function(e){return this.callback=e,this.isDone&&this._call(),this},g.etc={id:_id,wait:{on:function(e){if("String"==typeof e&&e.test(/(on|onclick)/))throw"Invalid name";return g.etc.wait[e]=g.etc.wait[e]||new _WaitObject,g.etc.wait[e]},onclick:function(e){if("true"!==e.getAttribute("data-disabled")){e.disabled=!0,e.setAttribute("data-disabled","true");var __oldCursor=e.style.cursor;e.style.cursor="wait";var __func=e.getAttribute("data-onclick"),__html=e.innerHTML,__index=0,__handle=setInterval(function(){e.innerHTML="⠇⠋⠙⠸⠴⠦"[__index++%6]},100);eval(__func).wait(function(){clearInterval(__handle),e.innerHTML=__html,e.disabled=!1,e.setAttribute("data-disabled","false"),e.style.cursor=__oldCursor})}}},file:function(e,t){if(e[0]&&e[0].type&&e.length){for(var n=[],r=0;r<e.length;r++)n.push(e[r]);return n}var i=_id(e);if(i.files&&i.files[0]){for(var n=[],r=0;r<i.files.length;r++)n.push(i.files[r]);return n}return t&&t.target&&t.target.value?[t.target.value]:[]},get:function(e){return document.querySelectorAll(e)},let:{hide:function(e){return g.etc.let.$=_id(e),g.etc.let.$.style.display="none",g.etc.let},show:function(e){g.etc.let.$=_id(e);var t=g.etc.let.$;switch(t.tagName.toLowerCase()){case"td":t.style.display="table-cell";break;case"table":t.style.display="table";break;case"li":t.style.display="list-item";break;case"a":case"span":t.style.display="inherit";break;default:t.style.display="block"}return g.etc.let},disable:function(e){return g.etc.let.$=_id(e),g.etc.let.$.disabled=!0,g.etc.let},enable:function(e){return g.etc.let.$=_id(e),g.etc.let.$.disabled=!1,g.etc.let}},date:{format:function(e,t){var n=new Date(e),r=(new Date,n.getFullYear()),i=n.getMonth()<9?"0"+(n.getMonth()+1):n.getMonth()+1,o=n.getDate()<10?"0"+n.getDate():n.getDate(),a=n.getHours()<10?"0"+n.getHours():n.getHours(),c=n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes(),s=n.getSeconds()<10?"0"+n.getSeconds():n.getSeconds();return ret=r+"/"+i+"/"+o+" "+a+":"+c+(t?":"+s:""),ret},now:function(){var e=new Date,t=e.getHours()<10?"0"+e.getHours():e.getHours(),n=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),r=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return t+":"+n+":"+r}},string:{unescape:function(e){var t=document.createElement("div");t.innerHTML=e;for(var n="",r=0;r<t.childNodes.length;++r)n+=t.childNodes[r].nodeValue;return n},utf8Len:function(e){if(encodeURIComponent){var t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)}return 0},base64Decode:function(e){var t={};return t.PADCHAR="=",t.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t.makeDOMException=function(){try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(e){var t=new Error("DOM Exception 5");return t.code=t.number=5,t.name=t.description="INVALID_CHARACTER_ERR",t.toString=function(){return"Error: "+t.name+": "+t.message},t}},t.getbyte64=function(e,n){var r=t.ALPHA.indexOf(e.charAt(n));if(-1===r)throw t.makeDOMException();return r},t.decode=function(e){e=""+e;var n,r,i,o=t.getbyte64,a=e.length;if(0===a)return e;if(a%4!==0)throw t.makeDOMException();n=0,e.charAt(a-1)===t.PADCHAR&&(n=1,e.charAt(a-2)===t.PADCHAR&&(n=2),a-=4);var c=[];for(r=0;a>r;r+=4)i=o(e,r)<<18|o(e,r+1)<<12|o(e,r+2)<<6|o(e,r+3),c.push(String.fromCharCode(i>>16,i>>8&255,255&i));switch(n){case 1:i=o(e,r)<<18|o(e,r+1)<<12|o(e,r+2)<<6,c.push(String.fromCharCode(i>>16,i>>8&255));break;case 2:i=o(e,r)<<18|o(e,r+1)<<12,c.push(String.fromCharCode(i>>16))}return c.join("")},t.decode(e)}},util:{ajax:promise,guid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)&&parseInt(e)>0},CSRF:function(){return _id("csrf").innerHTML},lazyLoad:function(e,t){var n=window.__cdn,r=function(){var i=function(){e.shift(),e.length>0?r():t&&t()},o=null,a=n+e[0];if(/\.js$/.test(a)){o=document.createElement("script");var c=document.querySelectorAll("script");for(var s in c)if(c[s].src==a)return void i();o.src=a,o.async=!0,o.onreadystatechange=o.onload=function(){(!o.readyState||/loaded|complete/.test(o.readyState))&&i()}}else if(/\.css$/.test(a)){o=document.createElement("link");var l=document.querySelectorAll("link");for(var s in l)l[s].href==a&&i();o.rel="stylesheet",o.type="text/css",o.href=a,o.media="all",i()}null!=o&&document.querySelector("head").appendChild(o)};r()},read:function(e){return window.attachEvent&&!window.addEventListener?null:localStorage?localStorage.getItem(e):null},write:function(e,t){return window.attachEvent&&!window.addEventListener?null:localStorage?localStorage.setItem(e,t):null},storage:{remove:function(e){return window.attachEvent&&!window.addEventListener?null:void(localStorage&&localStorage.removeItem(e))}},cookie:{read:function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""},write:function(e,t,n){var r=new Date;r.setTime(r.getTime()+n),document.cookie=e+"="+t+"; expires="+r.toUTCString()+"; path=/;"},"delete":function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}}},editor:{wrap:function(e){_editorId=e},insertHTML:_insertHTML,isInside:_insideEditor,getSelected:function(){return window.getSelection?window.getSelection():document.selection},getSelectedElements:function(){var e=function(e){if(e.hasChildNodes())return e.firstChild;for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null},t=function(t){var n=t.startContainer,r=t.endContainer;if(n==r)return[n];for(var i=[];n&&n!=r;)i.push(n=e(n));for(n=t.startContainer;n&&n!=t.commonAncestorContainer;)i.unshift(n),n=n.parentNode;return i};if(window.getSelection){var n=window.getSelection();if(!n.isCollapsed)return t(n.getRangeAt(0))}return[]},uploadImage:function(e,t,n){if(n=n||{},0==e.length)return void t();var r=e.shift(),i=function(e){alert("Err::Upload::"+e),t&&t()};return!_insideEditor()&&n.editor?void(t&&t()):r&&r.type.match(/image.*/)||/\.(jpg|png)\-(small|large)/.test(r.name)?void etc.util.ajax.$post(n.imgur?"https://api.imgur.com/3/image":"/upload",{image:r},{Authorization:"Client-ID c37fc05199a05b7"}).then(function(r,o,a){if(r)return void i("AJAX");try{var c=n.imgur?JSON.parse(o).data:JSON.parse(o)}catch(s){return i("JSON")}if(c.Error||c.error)return i("Server_Failure_"+c.R);var l=(c.Link||c.link).replace("http://","https://"),u=(c.Thumbnail||c.link).replace("http://","https://");n.editor&&(_id(n.editor).focus(),_insertHTML("<a href='"+l+"' target='_blank'><img src='"+u+"' class='article-image'></a>")),etc.editor.uploadImage(e,t,n)}):void i("Invalid_Image")},insertLink:function(){if(_insideEditor()){var e=prompt("URL:","http://"),t=window.getSelection?window.getSelection():document.selection;"http://"!=e&&""!=e&&((""==t||null==t)&&(t=prompt("显示文字:",e)),_id(_editorId).focus(),_insertHTML("<a href='"+e+"' target='_blank'>"+t+"</a>"))}},switchMonospace:function(){for(var e=_id(_editorId),t=e.getElementsByTagName("*"),n=e.attr("data-mono"),r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];if("#text"==i.nodeName){var o=document.createElement("span");o.innerHTML=i.nodeValue,e.insertBefore(o,i),e.removeChild(i)}}if("courier"===n){for(var r=t.length;r--;)t[r].className=t[r].className.replace(/font\-courier/g,"font-lucida");e.attr("data-mono","lucida")}else if("lucida"===n){for(var r=t.length;r--;)t[r].className=t[r].className.replace(/font\-(courier|lucida)/g,"");e.attr("data-mono","normal")}else{for(var r=t.length;r--;)t[r].className+=" font-courier";e.attr("data-mono","courier")}},insertList:function(e){_id(_editorId).focus(),"ol"==e?document.execCommand("insertorderedlist",!1):document.execCommand("insertunorderedlist",!1)},insertNode:function(e,t){_id(_editorId).focus(),"heading"==e?document.execCommand("formatBlock",!1,"<"+t+">"):document.execCommand(e,!1,t)},insertTable:function(){var e=prompt("行 x 列:","3x2"),t=e.split("x");if(!(t.length<2)){var n=parseInt(t[0]),r=parseInt(t[1]),i=parseInt(100/n),o="<tr>"+new Array(n+1).join("<td width="+i+"%>&nbsp;</td>")+"</tr>",a="<table border=1 class=_table>"+new Array(r+1).join(o)+"</table>";_insertHTML(a)}}}},document.addEventListener("DOMContentLoaded",function(){for(var e=document.querySelectorAll("*[data-onclick]"),t=0;t<e.length;t++)"A"===e[t].tagName&&(e[t].href="javascript:void(0)"),e[t].onclick=function(t){return function(){g.etc.wait.onclick(e[t])}}(t)},!1)}(this);var Animation=function(){var e,t;return{start:function(n){if(!e){var r=0;t=n,e=setInterval(function(){etc.id(n).innerHTML="⠇⠋⠙⠸⠴⠦"[r++%6]},100)}},stop:function(){var n=etc.id(t);n&&(n.innerHTML=""),e&&clearInterval(e),e=null}}}();