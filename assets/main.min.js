!function(g){function Promise(){this._callbacks=[]}function join(a){function f(a){return function(){d+=1,c[a]=Array.prototype.slice.call(arguments),d===e&&b.done(c)}}var b=new Promise,c=[];if(!a||!a.length)return b.done(c),b;for(var d=0,e=a.length,g=0;e>g;g++)a[g].then(f(g));return b}function chain(a,b){var c=new Promise;return 0===a.length?c.done.apply(c,b):a[0].apply(null,b).then(function(){a.splice(0,1),chain(a,arguments).then(function(){c.done.apply(c,arguments)})}),c}function _encode(a){var b="";if("string"==typeof a)b=a;else{var c=encodeURIComponent,d=[];for(var e in a)a.hasOwnProperty(e)&&d.push(c(e)+"="+c(a[e]));b=d.join("&")}return b}function new_xhr(){var a;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}return a}function ajax(a,b,c,d){function l(){f.abort(),e.done(promise.ETIMEOUT,"",f)}var f,g,e=new Promise;c=c||{},d=d||{};try{f=new_xhr()}catch(h){return e.done(promise.ENOXHR,""),e}var i="application/x-www-form-urlencoded";if("$"==a[0]){a=a.substring(1),g=new FormData,i="";for(var j in c)c.hasOwnProperty(j)&&g.append(j,c[j])}else g=_encode(c),"GET"===a&&g&&(b+="?"+g,g=null);f.open(a,b);for(var k in d)d.hasOwnProperty(k)&&("content-type"===k.toLowerCase()?i=d[k]:f.setRequestHeader(k,d[k]));""!=i&&f.setRequestHeader("Content-type",i);var m=promise.ajaxTimeout;if(m)var n=setTimeout(l,m);return f.onreadystatechange=function(){if(m&&clearTimeout(n),4===f.readyState){var a=!f.status||(f.status<200||f.status>=300)&&304!==f.status;e.done(a,f.responseText,f)}},f.send(g),e}function _ajaxer(a){return function(b,c,d){return ajax(a,b,c,d)}}function _WaitObject(){this.isDone=!1}Promise.prototype.then=function(a,b){var c;return this._isdone?c=a.apply(b,this.result):(c=new Promise,this._callbacks.push(function(){var d=a.apply(b,arguments);d&&"function"==typeof d.then&&d.then(c.done,c)})),c},Promise.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,arguments);this._callbacks=[]};var promise={Promise:Promise,join:join,chain:chain,ajax:ajax,get:_ajaxer("GET"),post:_ajaxer("POST"),$post:_ajaxer("$POST"),put:_ajaxer("PUT"),del:_ajaxer("DELETE"),ENOXHR:1,ETIMEOUT:2,ajaxTimeout:2e4},_id=function(a){var b="string"==typeof a||a instanceof String?document.getElementById(a):a;return null==b?{}:(b.on=function(a,c,d){return b.addEventListener?b.addEventListener(a,c,d):b.attachEvent("on"+a,c),b},b.html=function(a){return"string"==typeof a?b.innerHTML=a:a.innerHTML?b.innerHTML=a.innerHTML:b.innerHTML=a,b},b.attr=function(a,c){return c?(b.setAttribute(a,c),b):b.getAttribute(a)},b)},_editorId=null,_insideEditor=function(){var a=function(a){var b,c,d;return document.selection?(b=document.selection.createRange(),b.collapse(a),b.parentElement()):(c=window.getSelection(),c.getRangeAt?c.rangeCount>0&&(b=c.getRangeAt(0)):(b=document.createRange(),b.setStart(c.anchorNode,c.anchorOffset),b.setEnd(c.focusNode,c.focusOffset),b.collapsed!==c.isCollapsed&&(b.setStart(c.focusNode,c.focusOffset),b.setEnd(c.anchorNode,c.anchorOffset))),b?(d=b[a?"startContainer":"endContainer"],3===d.nodeType?d.parentNode:d):void 0)},b=function(a){if(a&&a.getAttribute){if("true"==a.getAttribute("contenteditable"))return!0;if(a.parentNode)return b(a.parentNode)}return!1};return b(a())},_insertHTML=function(a){var b,c;if(window.getSelection){if(b=window.getSelection(),b.getRangeAt&&b.rangeCount){c=b.getRangeAt(0),c.deleteContents();var d=document.createElement("div");d.innerHTML=a;for(var f,g,e=document.createDocumentFragment();f=d.firstChild;)g=e.appendChild(f);c.insertNode(e),g&&(c=c.cloneRange(),c.setStartAfter(g),c.collapse(!0),b.removeAllRanges(),b.addRange(c))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(a)};_WaitObject.prototype._call=function(){this.callback(),this.isDone=!1,this.callback=null},_WaitObject.prototype.done=function(){return this.isDone=!0,this.callback&&this._call(),this},_WaitObject.prototype.wait=function(a){return this.callback=a,this.isDone&&this._call(),this},g.etc={id:_id,wait:{on:function(a){if("String"==typeof a&&a.test(/(on|onclick)/))throw"Invalid name";return g.etc.wait[a]=g.etc.wait[a]||new _WaitObject,g.etc.wait[a]},onclick:function(e){if("true"!==e.getAttribute("data-disabled")){e.disabled=!0,e.setAttribute("data-disabled","true");var __oldCursor=e.style.cursor;e.style.cursor="wait";var __func=e.getAttribute("data-onclick"),__html=e.innerHTML,__index=0,__handle=setInterval(function(){e.innerHTML="⠇⠋⠙⠸⠴⠦"[__index++%6]},100);eval(__func).wait(function(){clearInterval(__handle),e.innerHTML=__html,e.disabled=!1,e.setAttribute("data-disabled","false"),e.style.cursor=__oldCursor})}}},file:function(a,b){if(a[0]&&a[0].type&&a.length){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);return c}var e=_id(a);if(e.files&&e.files[0]){for(var c=[],d=0;d<e.files.length;d++)c.push(e.files[d]);return c}return b&&b.target&&b.target.value?[b.target.value]:[]},get:function(a){return document.querySelectorAll(a)},let:{hide:function(a){return g.etc.let.$=_id(a),g.etc.let.$.style.display="none",g.etc.let},show:function(a){g.etc.let.$=_id(a);var b=g.etc.let.$;switch(b.tagName.toLowerCase()){case"td":b.style.display="table-cell";break;case"table":b.style.display="table";break;case"li":b.style.display="list-item";break;case"a":case"span":b.style.display="inherit";break;default:b.style.display="block"}return g.etc.let},disable:function(a){return g.etc.let.$=_id(a),g.etc.let.$.disabled=!0,g.etc.let},enable:function(a){return g.etc.let.$=_id(a),g.etc.let.$.disabled=!1,g.etc.let}},date:{format:function(a,b){var c=new Date(a),e=(new Date,c.getFullYear()),f=c.getMonth()<9?"0"+(c.getMonth()+1):c.getMonth()+1,g=c.getDate()<10?"0"+c.getDate():c.getDate(),h=c.getHours()<10?"0"+c.getHours():c.getHours(),i=c.getMinutes()<10?"0"+c.getMinutes():c.getMinutes(),j=c.getSeconds()<10?"0"+c.getSeconds():c.getSeconds();return ret=e+"/"+f+"/"+g+" "+h+":"+i+(b?":"+j:""),ret},now:function(){var a=new Date,b=a.getHours()<10?"0"+a.getHours():a.getHours(),c=a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes(),d=a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds();return b+":"+c+":"+d}},string:{unescape:function(a){var b=document.createElement("div");b.innerHTML=a;for(var c="",d=0;d<b.childNodes.length;++d)c+=b.childNodes[d].nodeValue;return c},utf8Len:function(a){if(encodeURIComponent){var b=encodeURIComponent(a).match(/%[89ABab]/g);return a.length+(b?b.length:0)}return 0},base64Decode:function(a){var b={};return b.PADCHAR="=",b.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b.makeDOMException=function(){try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(b){var c=new Error("DOM Exception 5");return c.code=c.number=5,c.name=c.description="INVALID_CHARACTER_ERR",c.toString=function(){return"Error: "+c.name+": "+c.message},c}},b.getbyte64=function(a,c){var d=b.ALPHA.indexOf(a.charAt(c));if(-1===d)throw b.makeDOMException();return d},b.decode=function(a){a=""+a;var d,e,f,c=b.getbyte64,g=a.length;if(0===g)return a;if(g%4!==0)throw b.makeDOMException();d=0,a.charAt(g-1)===b.PADCHAR&&(d=1,a.charAt(g-2)===b.PADCHAR&&(d=2),g-=4);var h=[];for(e=0;g>e;e+=4)f=c(a,e)<<18|c(a,e+1)<<12|c(a,e+2)<<6|c(a,e+3),h.push(String.fromCharCode(f>>16,f>>8&255,255&f));switch(d){case 1:f=c(a,e)<<18|c(a,e+1)<<12|c(a,e+2)<<6,h.push(String.fromCharCode(f>>16,f>>8&255));break;case 2:f=c(a,e)<<18|c(a,e+1)<<12,h.push(String.fromCharCode(f>>16))}return h.join("")},b.decode(a)}},util:{ajax:promise,guid:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)&&parseInt(a)>0},CSRF:function(){return _id("csrf").innerHTML},lazyLoad:function(a,b){var c=window.__cdn,d=function(){var e=function(){a.shift(),a.length>0?d():b&&b()},f=null,g=c+a[0];if(/\.js$/.test(g)){f=document.createElement("script");var h=document.querySelectorAll("script");for(var i in h)if(h[i].src==g)return void e();f.src=g,f.async=!0,f.onreadystatechange=f.onload=function(){(!f.readyState||/loaded|complete/.test(f.readyState))&&e()}}else if(/\.css$/.test(g)){f=document.createElement("link");var j=document.querySelectorAll("link");for(var i in j)j[i].href==g&&e();f.rel="stylesheet",f.type="text/css",f.href=g,f.media="all",e()}null!=f&&document.querySelector("head").appendChild(f)};d()},read:function(a){return window.attachEvent&&!window.addEventListener?null:localStorage?localStorage.getItem(a):null},write:function(a,b){return window.attachEvent&&!window.addEventListener?null:localStorage?localStorage.setItem(a,b):null},storage:{remove:function(a){return window.attachEvent&&!window.addEventListener?null:void(localStorage&&localStorage.removeItem(a))}},cookie:{read:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""},write:function(a,b,c){var d=new Date;d.setTime(d.getTime()+c),document.cookie=a+"="+b+"; expires="+d.toUTCString()+"; path=/;"},"delete":function(a){document.cookie=a+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}}},editor:{wrap:function(a){_editorId=a},insertHTML:_insertHTML,isInside:_insideEditor,getSelected:function(){return window.getSelection?window.getSelection():document.selection},uploadImage:function(a,b,c){if(c=c||{},0==a.length)return void b();var d=a.shift(),e=function(a){alert("Err::Upload::"+a),b&&b()};return!_insideEditor()&&c.editor?void(b&&b()):d&&d.type.match(/image.*/)||/\.(jpg|png)\-(small|large)/.test(d.name)?void etc.util.ajax.$post(c.imgur?"https://api.imgur.com/3/image":"/upload",{image:d},{Authorization:"Client-ID c37fc05199a05b7"}).then(function(d,f,g){if(d)return void e("AJAX");try{var h=c.imgur?JSON.parse(f).data:JSON.parse(f)}catch(i){return e("JSON")}if(h.Error||h.error)return e("Server_Failure_"+h.R);var j=(h.Link||h.link).replace("http://","https://"),k=(h.Thumbnail||h.link).replace("http://","https://");c.editor&&(_id(c.editor).focus(),_insertHTML("<a href='"+j+"' target='_blank'><img src='"+k+"' class='article-image'></a>")),etc.editor.uploadImage(a,b,c)}):void e("Invalid_Image")},insertLink:function(){if(_insideEditor()){var a=prompt("URL:","http://"),b=window.getSelection?window.getSelection():document.selection;"http://"!=a&&""!=a&&((""==b||null==b)&&(b=prompt("显示文字:",a)),_id(_editorId).focus(),_insertHTML("<a href='"+a+"' target='_blank'>"+b+"</a>"))}},insertFontsize:function(a){_insertHTML("<span class='"+a+"'>"+etc.editor.getSelected()+"</span>")},switchMonospace:function(){for(var a=_id(_editorId),b=a.getElementsByTagName("*"),c=a.attr("data-mono"),d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];if("#text"==e.nodeName){var f=document.createElement("span");f.innerHTML=e.nodeValue,a.insertBefore(f,e),a.removeChild(e)}}if("courier"===c){for(var d=b.length;d--;)b[d].className=b[d].className.replace(/font\-courier/g,"font-lucida");a.attr("data-mono","lucida")}else if("lucida"===c){for(var d=b.length;d--;)b[d].className=b[d].className.replace(/font\-(courier|lucida)/g,"");a.attr("data-mono","normal")}else{for(var d=b.length;d--;)b[d].className+=" font-courier";a.attr("data-mono","courier")}},insertList:function(a){_id(_editorId).focus(),"ol"==a?document.execCommand("insertorderedlist",!1):document.execCommand("insertunorderedlist",!1)},insertNode:function(a,b){_id(_editorId).focus(),"heading"==a?document.execCommand("formatBlock",!1,"<"+b+">"):document.execCommand(a,!1,b)},insertTable:function(){var a=prompt("行 x 列:","3x2"),b=a.split("x");if(!(b.length<2)){var c=parseInt(b[0]),d=parseInt(b[1]),e=parseInt(100/c),f="<tr>"+new Array(c+1).join("<td width="+e+"%>&nbsp;</td>")+"</tr>",g="<table border=1 class=_table>"+new Array(d+1).join(f)+"</table>";_insertHTML(g)}}}},document.addEventListener("DOMContentLoaded",function(){for(var a=document.querySelectorAll("*[data-onclick]"),b=0;b<a.length;b++)a[b].onclick=function(b){return function(){g.etc.wait.onclick(a[b])}}(b)},!1)}(this);var Animation=function(){var a,b;return{start:function(c){if(!a){var d=0;b=c,a=setInterval(function(){etc.id(c).innerHTML="⠇⠋⠙⠸⠴⠦"[d++%6]},100)}},stop:function(){var c=etc.id(b);c&&(c.innerHTML=""),a&&clearInterval(a),a=null}}}();